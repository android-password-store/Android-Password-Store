on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

env:
  SENTRY_DSN: 'https://public_key@example.com/project_id'

name: Shadow job with latest Gradle and Java
jobs:
  shadow-job:
    strategy:
      fail-fast: false
      matrix:
        agp-version:
          - 7.3.1
          - 7.4.0-beta03
          - 8.0.0-alpha06
        gradle-version:
          - wrapper
          - nightly
        java-version:
          - 11
          - 18
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # v3.1.0
      with:
        fetch-depth: 0

    - name: Set up JDK
      uses: actions/setup-java@19eeec562b37d29a1ad055b7de9c280bd0906d8d # v3.7.0
      with:
        distribution: temurin
        java-version: ${{ matrix.java-version }}

    - name: Copy CI gradle.properties
      run: mkdir -p ~/.gradle ; cp .github/ci-gradle.properties ~/.gradle/gradle.properties

    - name: Run checks
      uses: gradle/gradle-build-action@3fbe033aaae657f011f88f29be9e65ed26bd29ef # v2.3.3
      env:
        DEP_OVERRIDE: true
        DEP_OVERRIDE_agp: ${{ matrix.agp-version }}
      with:
        arguments: check
        gradle-home-cache-cleanup: true
